<!doctype html>
<html manifest="manifest.appcache">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Конвертер магнита (magnet converter)</title>
		<link rel="icon" type="image/svg+xml" href="../magnet-uri-logo/magnet-uri-logo.svg" />
		<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="icons/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="icons/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="icons/manifest.json">
		<link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="icons/favicon.ico">
		<meta name="msapplication-config" content="icons/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">
		<base href="https://ivan386.github.io/magnet-converter/" />
		
		<style>
			.btih, .bitprint, .md5, .sha1, .tree_tiger, 
			.ed2k, a#link, .urn, .url, .xurl, durl,
			.hurn, .hurl, .hxurl, .hdurls, .ifmagnet, .collections
			{display: none;}
			
			a#link[href*="magnet:?"] ~ #demo,
			a#link[href*="magnet:?"] ~ .info
			{display: none}
			
			a#link[href*="magnet:?"] ~ .ifmagnet{display: initial}
			
			a#link[href*="=urn:btih:"] ~ .btih,
			a#link[href*="=urn:bitprint:"] ~ .bitprint,
			a#link[href*="=urn:sha1:"] ~ .sha1,
			a#link[href*="=urn:tree:tiger:"] ~ .tree_tiger,
			a#link[href*="=urn:ed2k:"] ~ .ed2k,
			a#link[href*="=urn:ed2khash:"] ~ .ed2k,
			a#link[href*="as="] ~ #direct_links > .url,
			a#link[href*="ws="] ~ #direct_links > .url,
			a#link[href*="xs="] ~ #p2p_links > .xurl,
			a#link[href*="xs="] ~ #description_links > .durl,
			a#link[href*="mt="] ~ #p2p_collections > .collection,
			#this_page_links > a
			{
				display: list-item;
				position: relative;
				left: 20px;
			}
			
			
			a#link[href*="x.do="] ~ .hdurls,
			a#link[href*="=urn:"] ~ .hurn,
			a#link[href*="as="] ~ .hurl,
			a#link[href*="ws="] ~ .hurl,
			a#link[href*="xs="] ~ .hxurl,
			a#link[href*="mt="] ~ .collections{
				display: block;
			}
			
			a#link[href]{
				display: block;
				text-align: center;
				border: solid green 1px;
				padding-top: 1em;
				padding-bottom: 1em;
				border-radius: 1em;
				background-color: #9E9;
				color: black;
				text-decoration: none;
				font-size: xx-large;
			}
			#magnet_mix{width: 100%;}
			
			.script > .noscript{
				display: none;
			}
			
			#file-size{quotes: "(" ")";};
			
		</style>
		<script>
			function register_magnet_handler()
			{
				navigator.registerProtocolHandler('magnet', window.location.origin + window.location.pathname + '#%s', 'Magnet Converter');
			}
			function register_urn_handler()
			{
				navigator.registerProtocolHandler('urn', window.location.origin + window.location.pathname + '#magnet%3A%3Fxt=%s', 'Magnet Converter');
			}
			
		</script>
	</head>
	<body>
		<!--noscript-->
		
		<p class="noscript">!Для правильной работы необходимо включить JavaScript!</p>
		
		<p class="noscript">
		Для того чтобы открыть магнет-ссылку сотрите в адресной строке выше(где адрес этой страницы) часть до #magnet:?... вместе с # и нажмите Enter(на клавиатуре) или ->(рядом с адресной строкой)
		</p>
		<p class="noscript">
		Например должно остаться:<br>
		<code>magnet:?xt=urn:btih:CYST3G7LBX2J7YYLVTDC5IILUY4TT4HY&xl=2981763794&dn=ruwiki-20141114-pages-meta-current.xml.bz2&tr=http%3A//url2torrent.net%3A6970/announce</code>
		</p>
		
		<!--/noscript-->
		
		<a id="link"><img style="float: right; top: -0.7em; position: relative;" src="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo.svg"/> Скачать/Download <q id="file-name"></q><q id="file-size"></q> (Полный магнит/Full magnet)</a>
		
		<p class="info">
			Данная страница помогает собрать универсальную <a href="https://ru.wikipedia.org/wiki/Magnet-ссылка">magnet-ссылку(далее магнит)</a>. Скопировать URL на эту страницу со встроенным магнитом. Этот URL можно использовать для передачи в сообщении или публикации на форуме где не поддерживается вставка магнита.
		</p>
		<p class="info">	
			Также на странице вы найдёте магниты подходящие для разных <a href="https://ru.wikipedia.org/wiki/Одноранговая_сеть">одноранговых сетей(Peer to Peer).</a>
		</p>
		
		<p class="ifmagnet">Если клиент не распознал магнит попробуйте магниты ниже.</p>
		<p class="urn">Магниты и ссылки (Magnets and links):</p>
		<a class="torrent_magnet btih">Магнит для Торрента (Magnet for Torrent)</a>
		<a class="dc_magnet bitprint tree_tiger">Магнит для DC++ (Magnet for DC++)</a>
		<a class="shareaza_magnet bitprint tree_tiger sha1 ed2k btih">Магнит для Shareaza (Magnet for Shareaza)</a>
		<a class="ed2k_link ed2k">Ссылка для eMule (Link for eMule)</a>
		<a class="micro_torrent bitprint sha1">Микро-торрент (Micro Torrent)</a>
		<p class="hurl">Прямые ссылки (direct links):</p>
		<div class="hurl" id="direct_links"></div>
		<p class="hxurl">P2P источники (p2p sources):</p>
		<div class="hxurl" id="p2p_links"></div>
		<p class="collections">P2P Коллекции (p2p collections):</p>
		<div class="collections" id="p2p_collections"></div>
		<p class="hdurls">Страницы описания (description pages):</p>
		<div class="hdurls" id="description_links"></div>
		<p>Ссылки на эту страницу (links to this page):</p>
		<div id="this_page_links">
		<a href="#magnet:?" class="full_link">полная (full link)</a>
		<a href="/#magnet:?" class="short_link">короткая(short link)</a>
		<a href="/magnet?" class="short_msg_link">короткая для передачи в сообщении(short link to send in messenger)</a>
		<a href="http://magnet0.tk#magnet:?" class="shorter_link">ещё короче(shorter link)</a>
		<a href="http://магнит.tk#magnet:?" class="shorter_ru_link">ещё чуть короче но по русски ))(shorter link on russian domain)</a>
		<a href="http://и3.tk#magnet:?" class="shortest_ru_link">коротко по русски ))(shortest link on russian domain)</a>
		<a href="https://magnet-xt-urn.tk#magnet:?" class="magic_link">магическая ссылка(magic link)</a>
		
		</div>
		
		
		<p class="hurn">Сторонние сервисы (Third-party services):</p>
		
		<a target="_blank" class="virus_check bitprint sha1 md5">Проверка на вирусы (Virus check)</a>

		<a target="_blank" class="dc_search bitprint tree_tiger">Поиск в сети DirectConnect (DC) (Search in DirectConnect)</a>
<!--		<a target="_blank" class="bitzi_lookup bitprint sha1">Информация на Bitzi (File info from Bitzi)</a>
-->
		<a target="_blank" class="ikwyd_search btih">Информация о торренте (Torrent info) IKWYD</a>
		<a target="_blank" class="btdigg_search btih">Информация о торренте (Torrent info) BTDIG</a>
		<a target="_blank" class="torcache_torrent btih">Скачать торрент из хранилища торрентов (Download torrent file from torrent cache)</a>
		<a target="_blank" class="ed2k-stats ed2k">Статистика ed2k (Ed2k file statistic)</a>
		
		<p>В поле ниже можно скопировать <a href="https://ru.wikipedia.org/wiki/Magnet-ссылка">магниты</a> на один и тотже файл из разних p2p клиентов (Например из: <a href="https://ru.wikipedia.org/wiki/Shareaza">Shareaza</a>, <a href="https://ru.wikipedia.org/wiki/Direct_Connect">Direct Connect</a> и <a href="https://ru.wikipedia.org/wiki/BitTorrent_(протокол)">BitTorrent</a>). Также можно скопировать туда и ed2k ссылку на тотже файл (<a href="https://ru.wikipedia.org/wiki/EDonkey2000_(сеть)">EDonkey2000(eMule)</a>). По нажатии кнопки "Конвертировать" будет создан единый магнит.</p>
			
		<b>Добавить параметр:</b>
		<br /><label title="Ссылка на страницу с полным описанием файла." ><input checked="checked" type="radio" name="param" id="description_link" />страница описания (x.do)</label> <a href="http://habrahabr.ru/post/247209/">?</a>
		<br /><label title="Прямая ссылка на торрент файл в интернете"><input type="radio" name="param" id="torrent_file_link" />торрент файл (fl)</label>
		<br /><label title="Скорость с которой необходимо загружать файл для комфортного онлайн просмотра"><input type="radio" name="param" id="bitrate" />битрейт файла (br)</label> <a href="http://habrahabr.ru/post/247591/">?</a>
		<br /><input style="width:100%" id="add_part"/>
		<br /><button onclick="add_parametr_on_click()">Добавить</button>
		<br /><label><input type="checkbox" id="freebase_be"/>Добавить freebase.be кеш (Add freebase.be cache)</label><a href="http://freebase.be/g2cache.php">?</a><br/><label><input type="checkbox" id="ipfs_io"/>Добавить ipfs.io Webseed (Add ipfs.io Webseed)</label><a href="https://ipfs.io">?</a><br/>
		
		<button onclick="make_magnet_on_click()">Конвертировать(Convert)</button>   <button onclick="example_on_click()">Вставить пример(Insert example)</button><span id="demo"> &lt;- Нажмите "Вставить пример" а потом "Конвертировать" для демонстрации работы страницы.</span>
		<textarea rows="20" id="magnet_mix"></textarea>
		
		
		<script>
		
			function add_parametr_on_click(){
				var add_part = document.getElementById("add_part")
				var magnet_mix = document.getElementById("magnet_mix") 
				var description_link = document.getElementById("description_link").checked;
				var torrent_file_link = document.getElementById("torrent_file_link").checked;
				var bitrate = document.getElementById("bitrate").checked;
				if (add_part.value.length > 0){
					if (description_link)
						prefix = "x.do=";
					else if(torrent_file_link)
						prefix = "fl=";
					else if(bitrate)
						prefix = "br=";
					
					magnet_mix.value += "\nmagnet:?"+prefix+encodeURIComponent(add_part.value);
					add_part.value = "";
					
				}
			}
			
			function try_decode(data){
				try{
					data = decodeURIComponent(data);
				}catch(e){console.error(e)}
				return data;
			}
			
			function detect_ipfs_hash(url, file)
			{
				url.replace(/\/ipfs\/([123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]+)/,function(all, hash){
					if (!file.hash) file.hash = {};
					file.hash.ipfs = hash;
				})
				return;
			}
			
			function parse_urn(urn_name, urn_data, file)
			{
				if (!file.hash) file.hash = {};
				switch (urn_name){
					case "urn:sha1:":
						file.hash.sha1 = urn_data;
					break;
					case "urn:ed2k:":
					case "urn:ed2khash:":
						file.hash.ed2k = urn_data;
					break;
					case "urn:aich:":
						file.hash.aich = urn_data;
					break;
					case "urn:btih:":
						if (urn_data.length < 40)
							file.hash.btih = base32_to_hex(urn_data);
						else
							file.hash.btih = urn_data;
					break;
					case "urn:ipfs:":
						file.hash.ipfs = urn_data;
					break;
					case "urn:tree:tiger:":
						file.hash.tree_tiger = urn_data;
					break;
					case "urn:bitprint:":
						var sha1_tth = urn_data.split(".");
						if (sha1_tth && sha1_tth.length == 2){
							file.hash.sha1 = sha1_tth[0];
							file.hash.tree_tiger = sha1_tth[1];
							file.hash.bitprint = urn_data;
						}
					break;
					default:
						if (!file.urns) file.urns = [];
						file.urns.push(urn_name+urn_data);
				}
			}
			
			function parse_magnet(params, file){
				if (!file) file = {}
				params.replace(/([a-z0-9\.]+)=((([a-z0-9\.]+:)*)([^&]+))&?/gmi,
				function(all, name, data, urn, _, urn_data){
					data = try_decode(data)
					switch (name){
						case "dn":
							file.name = data;
							break;
						case "xl":
							file.size = data;
							break;
						case "br":
							file.bitrate = data;
							break;
						case "tr":
							if (!file.trackers) file.trackers = [];
							file.trackers.push(data);
							break;
						case "mt":	
							file.collection = file.collection || [];
							file.collection.push(data);
							break;
						case "x.do":
							if (!file.description_url) file.description_url = [];
							file.description_url.push(data);
							break;
						case "fl":
							if (!file.torrent_file_url) file.torrent_file_url = [];
							file.torrent_file_url.push(data);
							break;
						case "as":
						case "ws":
							if (!file.url) file.url = [];
							file.url.push(data);
							detect_ipfs_hash(data, file);
							break;
						case "xs":
							if (!file.xurl) file.xurl = [];
							file.xurl.push(data);
							detect_ipfs_hash(data, file);
							break;
						case "xt":
							parse_urn(urn, urn_data, file)
							break;
						case "x.ed2k.p":
							(file.hash_list = file.hash_list || {}).ed2k = data.split(":");
							break;
					}
				})
				return file;
			}
			
			function torrent_magnet(file){
				var magnet = ["magnet:?"]
				if (file && file.hash && file.hash.btih) {
					magnet.push("xt=urn:btih:")
					magnet.push(encodeURIComponent(file.hash.btih))
				}else return undefined;
				if (file.name) {
					magnet.push("&dn=")
					magnet.push(encodeURIComponent(file.name))
				}
				if (file.trackers) {
					for (var i=0; i < file.trackers.length; i++){
						magnet.push("&tr=")
						magnet.push(encodeURIComponent(file.trackers[i]))
					}
				}
				if (file.url){
					for (var i=0; i < file.url.length; i++){
						magnet.push("&ws=")
						magnet.push(encodeURIComponent(file.url[i]))
					}
				}
				if (file.torrent_file_url){
					for (var i=0; i < file.torrent_file_url.length; i++){
						magnet.push("&fl=")
						magnet.push(file.torrent_file_url[i])
					}
				}
				return magnet.join("")
			}
			
			function dc_magnet(file){
				var magnet = ["magnet:?"]
				if (file && file.hash && file.hash.tree_tiger) {
					magnet.push("xt=urn:tree:tiger:")
					magnet.push(file.hash.tree_tiger)
				}else return;
				if (file.size) {
					magnet.push("&xl=")
					magnet.push(encodeURIComponent(file.size))
				}
				if (file.name) {
					magnet.push("&dn=")
					magnet.push(encodeURIComponent(file.name))
				}
				if (file.xurl){
					for (var i=0; i < file.xurl.length; i++){
						magnet.push("&xs=")
						magnet.push(file.xurl[i])
					}
				}
				if (file.description_url){
					for (var i=0; i < file.description_url.length; i++){
						magnet.push("&x.do=")
						magnet.push(encodeURIComponent(file.description_url[i]))
					}
				}
				return magnet.join("")
			}
			
			function ed2k_link(file){
				var link = ["ed2k://|file"]
				if (file && file.hash && file.name && file.size && file.hash.ed2k) {
					link.push(encodeURIComponent(file.name))
					link.push(file.size)
					link.push(file.hash.ed2k)
					if (file.hash.aich){
						link.push("h=" + file.hash.aich)
					}
					
					if (file.hash_list && file.hash_list.ed2k){
						link.push("p=" + file.hash_list.ed2k.join(":"))
					}
					
					if (file.url){
						for (var i=0; i < file.url.length; i++){
							link.push("s=" + encodeURIComponent(file.url[i]))
						}
					}
					
					if (file.collection){
						for (var i=0; i < file.collection.length; i++){
							link.push("f=" + encodeURIComponent(file.collection[i]))
						}
					}
					
					if (file.xurl){
						var sources = [];
						file.xurl.map(
							function (xurl){
								var matches = (/ed2kftp\:\/\/([^\/]+)\/[a-z0-9]+\/[0-9]+\//gmi).exec(xurl)
								if (matches)
									sources.push(matches[1]);
							}
						)
						if ( sources.length > 0 )
							link.push("/|sources," + sources.join(","))
					}
					
					link.push("/")
					return link.join("|")
				}
			}
			
			function full_magnet(file, as){
				var magnet = ["magnet:?"]
				var amp = false
				if (!file) return;
				if (file.hash){
					if (file.hash.btih){
						magnet.push("xt=urn:btih:")
						magnet.push(file.hash.btih)
						amp = true;
					}
					if (file.hash.sha1 && file.hash.tree_tiger){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:bitprint:")
						magnet.push(file.hash.sha1)
						magnet.push(".")
						magnet.push(file.hash.tree_tiger)
					}else if(file.hash.sha1){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:sha1:")
						magnet.push(file.hash.sha1)
					}else if(file.hash.tree_tiger){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:tree:tiger:")
						magnet.push(file.hash.tree_tiger)
					}
					if (file.hash.ed2k){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:ed2k:")
						magnet.push(file.hash.ed2k)
					}
				}
				if (file.size) {
					if (amp) magnet.push("&"); else amp = true;
					magnet.push("xl=")
					magnet.push(encodeURIComponent(file.size))
				}
				if (file.name) {
					if (amp) magnet.push("&"); else amp = true;
					magnet.push("dn=")
					magnet.push(encodeURIComponent(file.name))
				}
				if (file.hash){
					if (file.hash.aich){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:aich:")
						magnet.push(file.hash.aich)
					}
					if (file.hash.ipfs){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=urn:ipfs:")
						magnet.push(file.hash.ipfs)
					}
				}
				if (file.urns){
					file.urns.map((urn)=>{
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xt=")
						magnet.push(urn)
						return urn;
					})
				}
				if (file.trackers){
					for (var i=0; i < file.trackers.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("tr=")
						magnet.push(encodeURIComponent(file.trackers[i]))
					}
				}
				if (file.url){
					for (var i=0; i < file.url.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						if (as || !(file.hash && file.hash.btih))
							magnet.push("as=");
						else
							magnet.push("ws=");
						magnet.push(encodeURIComponent(file.url[i]))
					}
				}
				if (file.bitrate){
					if (amp) magnet.push("&"); else amp = true;
					magnet.push("br=")
					magnet.push(encodeURIComponent(file.bitrate))
				}
				if (file.description_url){
					for (var i=0; i < file.description_url.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("x.do=")
						magnet.push(encodeURIComponent(file.description_url[i]))
					}
				}
				if (file.torrent_file_url){
					for (var i=0; i < file.torrent_file_url.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("fl=")
						magnet.push(encodeURIComponent(file.torrent_file_url[i]))
					}
				}
				if (file.collection){
					for (var i=0; i < file.collection.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("mt=")
						magnet.push(encodeURIComponent(file.collection[i]))
					}
				}
				if (file.hash_list && file.hash_list.ed2k){
					if (amp) magnet.push("&"); else amp = true;
					magnet.push("x.ed2k.p=")
					magnet.push(file.hash_list.ed2k.join(":"))
				}
				if (file.xurl){
					for (var i=0; i < file.xurl.length; i++){
						if (amp) magnet.push("&"); else amp = true;
						magnet.push("xs=")
						magnet.push(file.xurl[i])
					}
				}
				if ( magnet.length > 1 )
					return magnet.join("");
			}
			
			function set_links(class_name, href, download){
				if (href){
					var links = document.getElementsByClassName(class_name)
					for (var i=0; i < links.length; i++)
					{
						links[i].setAttribute("href", href)
						if (download)
							links[i].setAttribute("download", download)
					}
				}
			}
			
			function base32_to_hex(base32){
				// http://tools.ietf.org/html/rfc4648
				if (!base32) return "";
				var number = 0
				var bit_pos = 0
				var detector = /[2-7a-z]/gmi
				var hex_str = []
				base32.replace(detector, function(letter){
					var val = parseInt(letter, 36);

					if (val <= 7)
						val += 24;
					else
						val -= 10;
					
					number = ((number << 5) | val) & 255
					bit_pos += 5
					
					for (; bit_pos >= 4;){
						bit_pos -= 4
						var hex_num = (number >> bit_pos) & 15
						hex_str.push(hex_num.toString(16))
					}
				})
				
				return hex_str.join("");
			}

			/* https://habrahabr.ru/post/118171/ */
			function parse_ed2k_parts(params, sources, file)
			{
				if (params){
					var params_re = /([a-z])=([^\|]+)\|/gmi
					while (p = params_re.exec(params))
					{
						switch(p[1])
						{
							case "h":
								(file.hash = file.hash || {}).aich = p[2];
								break;
							case "s":
								(file.url = file.url || []).push(try_decode(p[2]));
								break;
							case "p":
								(file.hash_list = file.hash_list || {}).ed2k = p[2].split(":");
								break;
							case "f":
								(file.collection = file.collection || []).push(try_decode(p[2]));
								break;
						}
					}
				}

				if (sources){
					file.xurl = file.xurl || [];
					sources.split(",").map(
						(source)=>file.xurl.push("ed2kftp://"+source+"/"+file.hash.ed2k+"/"+file.size+"/")
					)
				}
			}
			
			function parse_text(text){
				var ere = /ed2k:\/\/\|file\|([^\|]+)\|([0-9]+)\|([a-z0-9]+)\|(([a-z]=[^\|]+\|)*)(\/\|sources,([^\|]+)\|){0,1}\//gmi
				var mre = /[^\s]*magnet:\?([^\s]+)/gmi
				var hre = /https?:\/\/[\S]*?\/([^\s\/]+)\/?$/gmi
				var dre = /dchub:\/\/[\S]+/gmi
				var urn = /(urn:([a-z0-9\.]+:)*)([^&\s]+)/gmi
				var file = {}
				text.replace(ere, function(all, name, size, hash, params, sources){
					file.name = try_decode(name);
					file.size = size;
					(file.hash = file.hash || []).ed2k = hash;
					parse_ed2k_parts(arguments[4], arguments[7], file);
					return "";
				}).replace(mre, function (all, params){
					parse_magnet(params, file);
					return "";
				}).replace(hre, function (url, name){
					(file.url = file.url || []).push(url)
					if (!file.name && name) file.name = name;
					detect_ipfs_hash(url, file)
					return "";
				}).replace(dre, function (xurl){
					(file.xurl = file.xurl || []).push(xurl)
					return "";
				}).replace(urn, function (all, urn_name, _, urn_data){
					console.log(urn_name, urn_data)
					parse_urn(urn_name, urn_data, file)
					return "";
				});
				return file
			}
			
			function make_link(part, hash, part2){
				if (hash) return [part, hash, part2].join("")
			}
			
			function raw_length(encodedURI){
				var count = 0;
				var index = 0;
				for (index = encodedURI.indexOf("%"); index>=0 && (++count) ; index = encodedURI.indexOf("%", index+1));
				return encodedURI.length-count*2
			}
			
			function push_string(string, to_list){
				to_list.push(raw_length(string))
				to_list.push(":")
				to_list.push(string)
			}
			
			function make_micro_torrent(file){
				if (file.name && file.size && file.hash && file.hash.sha1){
					var torrent = ["data:application/x-bittorrent;,d"]
					if (file.trackers && file.trackers.length>0){
						torrent.push("8:announce")
						push_string(file.trackers[0], torrent)
						if (file.trackers.length>1){
							torrent.push("13:announce-listl")
							for (var i = 1; file.trackers.length>i; i++){
								var tracker = encodeURIComponent(decodeURIComponent(file.trackers[i]))
								push_string(tracker, torrent)
							}
							torrent.push("e")
						}
					}
					torrent.push("4:infod")
					torrent.push("6:length")
					torrent.push("i")
					torrent.push(file.size)
					torrent.push("e")
					torrent.push("4:name")
					var name = encodeURIComponent(file.name)
					push_string(name, torrent)
					torrent.push("12:piece%20length")
					torrent.push("i")
					torrent.push(file.size < 16384 ? 16384 : file.size)
					torrent.push("e")
					torrent.push("6:pieces")
					var sha1 = file.hash.sha1
					if (sha1.length < 40)
						sha1 = base32_to_hex(sha1);
					sha1 = sha1.replace(/[0-9A-Fa-f]{2}/g,"%$&")
					push_string(sha1, torrent)
					torrent.push("e")
					if (file.url && file.url.length>0){
						torrent.push("8:url-listl")
						for (var i = 0; file.url.length>i; i++){
							var url = encodeURIComponent(decodeURIComponent(file.url[i]))
							push_string(url, torrent)
						}
						torrent.push("e")
					}
					torrent.push("e")
					return torrent.join("")
				}
			}
			
			function set_urls(urls, container_id, urls_class){
				if (!urls) return;
				var container = document.getElementById(container_id)
				var new_container = document.createElement(container.tagName)
				for (var i=0; i < urls.length; i++){
					var link =  document.createElement("a")
					var name = document.createTextNode(urls[i])
					link.href = urls[i]
					link.className = urls_class
					link.appendChild(name)
					new_container.appendChild(link)
				}
				container.parentNode.replaceChild(new_container, container)
				new_container.id = container.id
				new_container.className = container.className
				
			}

			function set_file(file){
				if(file){
					document.getElementById("file-name").textContent = file.name
					document.getElementById("file-size").textContent = file.size
					document.title = (file.name || "") + " " + (title || "")
					set_links("torrent_magnet", torrent_magnet(file))
					set_links("dc_magnet", dc_magnet(file))
					set_links("shareaza_magnet", full_magnet(file, true))
					set_links("ed2k_link", ed2k_link(file))
					set_links("micro_torrent", make_micro_torrent(file), file.name + ".micro.torrent")
					
					if (file.hash){
						set_links("virus_check", 
							make_link("http://www.virustotal.com/latest-report.html?resource=", base32_to_hex(file.hash.sha1)))
						set_links("dc_search", 
									make_link("http://dc.proisk.com?tiger=", file.hash.tree_tiger))
	/*					set_links("bitzi_lookup", 
									make_link("http://bitzi.com/lookup/", 
										file.hash.bitprint 
										|| file.hash.sha1 			
										||	(file.hash.tree_tiger?["tree:tiger:",file.hash.tree_tiger].join(""):false)
										||	(file.hash.ed2k?["ed2k:",file.hash.ed2k].join(""):false)					)
								)
	*/					if (file.hash.btih){
							set_links("ikwyd_search", 
										make_link("https://iknowwhatyoudownload.com/torrent/?infohash=", file.hash.btih))
							set_links("btdigg_search", 
										make_link("https://btdig.com/search?info_hash=", file.hash.btih))
							set_links("torcache_torrent", 
										make_link("http://btcache.me/torrent/", file.hash.btih.toUpperCase()))
						}
						if (file.hash.ed2k)
							set_links("ed2k-stats", 
								make_link("https://ed2k.shortypower.org/?hash=", file.hash.ed2k))
					}
					set_urls(file.url,"direct_links", "url")
					set_urls(file.xurl,"p2p_links", "xurl")
					set_urls(file.collection,"p2p_collections", "collection")
					set_urls(file.description_url,"description_links", "durl")
				}

				
				var hash = window.location.hash
				if (hash && hash.length > 1){
					if (hash && (hash.indexOf("#") != 0)){
						hash = "#" + hash
					}else if(!hash){
						hash = "#magnet:?"
					}
					
					set_links("full_link", hash)
					set_links("short_link", "/" + hash)
					set_links("short_msg_link", "/" + hash.replace("#magnet:?", "magnet?"))
					set_links("shorter_link", hash.replace("#magnet:?", "http://magnet0.tk#magnet:?"))
					set_links("magic_link", hash.replace("#magnet:?", "http://magnet-xt-urn.tk#magnet:?"))
					set_links("shorter_ru_link", hash.replace("#magnet:?", "http://магнит.tk#magnet:?"))
					set_links("shortest_ru_link", hash.replace("#magnet:?", "http://и3.tk#magnet:?"))
				}
			}
			
			var title = document.title
			var hash = document.location.hash
			
			if(hash.substr(1,6) == "urn%3A")
				hash = try_decode(hash);
			
			
			if(hash.substr(1,4) == "urn:")
			{
				hash = "#magnet:?xt=" + hash.substr(1);
				document.location.hash = hash;
			}
			
			if(hash.substr(1,12) == "magnet%3A%3F")
				hash = try_decode(hash);
				
			if(hash.substr(1,2) == ":?")
			{
				hash = "#magnet" + hash.substr(1);
				document.location.hash = hash;
			}
			
			if(hash.length <= 1 && document.referrer.indexOf("magnet:?") > 0)
			{
				hash = "#" + document.referrer.substr(document.referrer.indexOf("magnet:?"));
				document.location.hash = hash;
			}
			
			if(hash.length <= 1 && document.referrer.indexOf("magnet%3A%3F") > 0)
			{
				hash = "#" + document.referrer.substr(document.referrer.indexOf("magnet%3A%3F"));
				hash = try_decode(hash);
				document.location.hash = hash;
			}

			var start = hash.indexOf("magnet:?")
			if (start > 0) {
				var magnet = hash.substr(start)
				document.getElementById("magnet_mix").value = magnet
				document.getElementById("link").href = magnet
				file = parse_magnet(magnet.substr(8))
				set_file(file)
			}
			
			function make_magnet_on_click(){
				var magnet_mix = document.getElementById("magnet_mix")
				var file = parse_text(magnet_mix.value)
				var freebase = document.getElementById("freebase_be")
				if (freebase.checked && file.hash && file.hash.sha1){
					if (!file.xurl)
						file.xurl = [];
					file.xurl.push("http://cache.freebase.be/"+file.hash.sha1.toLowerCase());
					freebase.checked = false;
				}
				var ipfs_io = document.getElementById("ipfs_io")
				if (ipfs_io.checked && file.hash && file.hash.ipfs)
				{
					if (!file.url)
						file.url = [];
					file.url.push("https://ipfs.io/ipfs/"+file.hash.ipfs)
					file.url.push("https://127.0.0.1:8080/ipfs/"+file.hash.ipfs)
					ipfs_io.checked = false;
				}
				var magnet = full_magnet(file)
				document.location.hash = magnet
				document.getElementById("link").href = magnet
				magnet_mix.value = magnet
				set_file(file)
			}
			
			function example_on_click(){
				document.getElementById("magnet_mix").value = [
				"magnet:?xt=urn:btih:CYST3G7LBX2J7YYLVTDC5IILUY4TT4HY&xl=2981763794&dn=ruwiki-20141114-pages-meta-current.xml.bz2&tr=http%3A//url2torrent.net%3A6970/announce",
				"ed2k://|file|ruwiki-20141114-pages-meta-current.xml.bz2|2981763794|0218392e98873112284de6913efee0df|/",
				"magnet:?xt=urn:bitprint:U24IYRP3WTLRY5KJH7SACBLFT2LAM62U.JNOANHGPELY63I2OMSPQ3J73AS2P4AWB5MTBJCQ&xl=2981763794&dn=ruwiki-20141114-pages-meta-current.xml.bz2",
				"http://dumps.wikimedia.org/ruwiki/20141114/ruwiki-20141114-pages-meta-current.xml.bz2",
				
				"dchub://allavtovo.ru",
				
				"magnet:?x.do=https://dumps.wikimedia.org/ruwiki/20141114/",
				
				"magnet:?fl=http://itorrents.org/torrent/16253D9BEB0DF49FE30BACC62EA10BA63939F0F8.torrent",
				
				"magnet:?xs=http://cache.freebase.be/u24iyrp3wtlry5kjh7sacblft2lam62u"
				
				].join("\n\n")
			}

			if (window.location.hash.substr(1,8) == "magnet:?"){
				setTimeout(function() {window.location.replace(window.location.hash.substr(1))}, 0);
			}
		</script>
		
		<p>Данная страничка использует информацию переданную ей в url. Таким образом на сайте не хранится никакая иформация о файлах на которые эта страничка может ссылаться.</p>
		
		<p>Вы можете скопировать данную страницу или её чась и разместить у себя на сайте. Также вы можете использовать данные любым другим образом.</p>
		
		<p>
			<a href="" download>Сохранить страничку</a>
		</p>
		<p>
			Данная кнопка нужна только в случае если вы эту страницу используете как конвертер магнет ссылок и будете самостоятельно копировать нужный вид магнет ссылки в P2P клиент.
			<button onclick="register_magnet_handler()">Зарегистрировать как обработчик магнет ссылок(Register magnet handler)</button>
			
			<button onclick="register_urn_handler()">Зарегистрировать как обработчик URN ссылок(Register URN handler)</button> [? <a href="https://ru.wikipedia.org/wiki/URN">RU</a>|<a href="https://en.wikipedia.org/wiki/URN">EN</a>]
		</p>
		<p>
			Значок для обозначения магнита (Icon for magnet):
			<img src="../magnet-uri-logo/magnet-uri-logo-mini.svg"/><a href="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-mini.svg">https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-mini.svg</a></br>
			Вы можете свободно использовать его для обозначения магнита на просторах интернета и вне его.
		</p>
		<p>
			Есть другие версии:</br>
			<a href="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo.svg">https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo.svg</a></br>
			<a href="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-fullscreen.svg">https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-fullscreen.svg</a>
		</p>
		<script>document.body.classList.add("script")</script>
	</body>
</html>
